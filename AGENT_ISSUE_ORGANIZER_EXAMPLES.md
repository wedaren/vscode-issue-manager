# 问题节点关系整理 Agent - 使用示例

本文档提供了使用"问题节点关系整理助手" Agent 的实际示例。

## 场景 1：分析并清理重复引用

### 问题描述
你发现某个重要的设计文档被引用了太多次，导致在不同地方看到重复的内容，想要清理这些过度的引用。

### 使用步骤

1. **调用 Agent**：
   ```
   请帮我分析文件 "design-document-v2.md" 的所有引用，
   并建议如何清理重复的引用
   ```

2. **Agent 分析**：
   ```markdown
   ## 文件引用分析报告
   
   ### 基本信息
   - 文件名: design-document-v2.md
   - 总引用次数: 6 次
   
   ### 引用位置详情
   1. 节点 ID: abc123
      - 路径: 项目 A > 设计文档
      - 父节点: "项目 A 总览"
      
   2. 节点 ID: def456
      - 路径: 项目 B > 参考资料
      - 父节点: "项目 B 资源"
      
   3. 节点 ID: ghi789
      - 路径: 设计规范 > 案例分析
      - 父节点: "设计规范"
      
   4-6. 其他 3 个引用...
   
   ### 建议
   基于上下文分析，建议保留以下 3 个引用：
   - 路径 1: 作为项目 A 的核心设计文档
   - 路径 3: 作为设计规范的案例参考
   - 路径 2: 作为项目 B 的外部参考
   
   可以移除的引用（3个）：
   - 节点 ID xyz123: 与路径 1 重复
   - 节点 ID xyz456: 与路径 2 重复
   - 节点 ID xyz789: 与路径 3 重复
   ```

3. **用户确认**：
   ```
   好的，请执行清理操作，移除这 3 个重复的引用
   ```

4. **Agent 执行**：
   ```markdown
   ## 执行清理操作
   
   ### 备份创建
   ✅ 已创建备份: .issueManager/tree.json.backup.20260131_173000
   
   ### 执行操作
   ✅ 移除节点 xyz123 (路径: 项目 A > 归档 > 旧版设计)
   ✅ 移除节点 xyz456 (路径: 临时 > 待整理)
   ✅ 移除节点 xyz789 (路径: 项目 B > 归档)
   
   ### 结果
   - 移除节点数: 3
   - 保留节点数: 3
   - 文件 "design-document-v2.md" 现在有 3 个引用
   
   ### 验证
   ✅ tree.json 格式正确
   ✅ 已触发视图刷新
   ```

## 场景 2：整理孤立节点

### 问题描述
你创建了很多零散的想法和笔记，现在想要将这些孤立的节点组织成有意义的结构。

### 使用步骤

1. **调用 Agent**：
   ```
   我有很多孤立的笔记节点，请帮我分析这些节点，
   并建议如何组织它们
   ```

2. **Agent 分析**：
   ```markdown
   ## 孤立节点分析报告
   
   ### 统计信息
   - 总孤立节点数: 25 个
   - 按创建时间分布:
     - 本周: 8 个
     - 上周: 5 个
     - 本月: 12 个
   
   ### 节点分类建议
   
   #### 分类 1: 技术学习笔记 (10个)
   - learning-react-hooks.md
   - typescript-generics.md
   - docker-best-practices.md
   - ... (7 个更多)
   
   建议：创建"技术学习"父节点，将这些节点归类其下
   
   #### 分类 2: 项目想法 (8个)
   - new-app-idea-20250115.md
   - feature-wishlist-mobile.md
   - ui-improvement-notes.md
   - ... (5 个更多)
   
   建议：创建"项目想法"父节点
   
   #### 分类 3: 工作日志 (7个)
   - daily-log-20250125.md
   - meeting-notes-20250120.md
   - ... (5 个更多)
   
   建议：创建"工作日志"父节点，按时间组织
   ```

3. **用户决策**：
   ```
   很好的建议！请帮我执行这个分类方案。
   如果父节点不存在，请先创建它们
   ```

4. **Agent 执行**：
   ```markdown
   ## 执行整理操作
   
   ### 备份创建
   ✅ 已创建备份: .issueManager/tree.json.backup.20260131_173500
   
   ### 创建父节点
   ✅ 创建节点: "技术学习" (ID: parent001)
   ✅ 创建节点: "项目想法" (ID: parent002)
   ✅ 创建节点: "工作日志" (ID: parent003)
   
   ### 移动子节点
   技术学习 (10个):
   ✅ 移动 learning-react-hooks.md
   ✅ 移动 typescript-generics.md
   ... (8 个更多)
   
   项目想法 (8个):
   ✅ 移动 new-app-idea-20250115.md
   ... (7 个更多)
   
   工作日志 (7个):
   ✅ 移动 daily-log-20250125.md
   ... (6 个更多)
   
   ### 结果
   - 创建父节点: 3 个
   - 整理节点: 25 个
   - 剩余孤立节点: 0 个
   
   ### 验证
   ✅ tree.json 格式正确
   ✅ 已触发视图刷新
   ```

## 场景 3：扁平化深层结构

### 问题描述
你的某个项目分支层级太深（超过 6 层），导致在视图中查看很不方便，想要重新组织这个结构。

### 使用步骤

1. **调用 Agent**：
   ```
   我的"大型项目 X"分支层级太深了，
   请分析这个分支的结构并提出优化方案
   ```

2. **Agent 分析**：
   ```markdown
   ## 层级结构分析
   
   ### 当前结构
   ```
   大型项目 X
   └── 阶段一
       └── 需求分析
           └── 用户研究
               └── 访谈记录
                   └── 详细笔记
                       └── 第一轮访谈
                           └── 用户A访谈.md (深度: 7层)
   ```
   
   ### 问题
   - 最大深度: 7 层
   - 超过 5 层的节点: 12 个
   - 导航困难度: 高
   
   ### 优化方案
   
   #### 方案 1: 扁平化到 3 层
   ```
   大型项目 X
   ├── 需求分析
   │   ├── 用户访谈-第一轮
   │   │   ├── 用户A访谈.md
   │   │   ├── 用户B访谈.md
   │   │   └── ...
   │   └── 用户访谈-第二轮
   │       └── ...
   ├── 设计阶段
   │   └── ...
   └── 开发阶段
       └── ...
   ```
   
   #### 方案 2: 适度扁平化到 4 层
   ```
   大型项目 X
   ├── 阶段一-需求
   │   ├── 用户研究
   │   │   ├── 第一轮访谈
   │   │   │   ├── 用户A访谈.md
   │   │   │   └── ...
   │   │   └── 第二轮访谈
   │   │       └── ...
   │   └── 竞品分析
   │       └── ...
   └── ...
   ```
   
   ### 推荐
   推荐方案 1：层级清晰，便于导航
   ```

3. **用户确认**：
   ```
   采用方案 1，执行扁平化重组
   ```

4. **Agent 执行**：
   ```markdown
   ## 执行结构重组
   
   ### 备份创建
   ✅ 已创建备份: .issueManager/tree.json.backup.20260131_174000
   
   ### 重组操作
   
   阶段 1: 提取深层节点
   ✅ 提取 12 个深层节点到临时列表
   
   阶段 2: 重建结构
   ✅ 创建新的中间节点 "需求分析"
   ✅ 创建新的中间节点 "用户访谈-第一轮"
   ✅ 创建新的中间节点 "用户访谈-第二轮"
   
   阶段 3: 移动节点到新位置
   ✅ 移动 用户A访谈.md -> 大型项目 X/需求分析/用户访谈-第一轮/
   ✅ 移动 用户B访谈.md -> 大型项目 X/需求分析/用户访谈-第一轮/
   ... (10 个更多)
   
   阶段 4: 清理空节点
   ✅ 移除 7 个空的中间节点
   
   ### 结果
   - 重组前最大深度: 7 层
   - 重组后最大深度: 3 层
   - 受影响节点: 12 个
   - 移除空节点: 7 个
   
   ### 验证
   ✅ tree.json 格式正确
   ✅ 所有节点路径有效
   ✅ 已触发视图刷新
   ```

## 场景 4：清理无效引用

### 问题描述
在重命名或移动了一些文件后，tree.json 中可能存在引用不存在文件的节点。

### 使用步骤

1. **调用 Agent**：
   ```
   检查并清理所有引用不存在文件的节点
   ```

2. **Agent 分析和执行**：
   ```markdown
   ## 无效引用检测
   
   ### 扫描结果
   正在扫描 tree.json 中的所有节点...
   ✅ 扫描完成，共检查 156 个节点
   
   ### 发现的问题
   找到 3 个无效引用：
   
   1. 节点 ID: invalid001
      - 引用文件: old-notes/deprecated-20250110.md
      - 问题: 文件不存在
      - 位置: 归档 > 旧笔记
   
   2. 节点 ID: invalid002
      - 引用文件: temp/scratch-notes.md
      - 问题: 文件不存在
      - 位置: 临时 > 草稿
   
   3. 节点 ID: invalid003
      - 引用文件: projects/deleted-project.md
      - 问题: 文件不存在
      - 位置: 项目 > 已删除
   
   ### 清理建议
   建议移除这 3 个无效节点
   
   ### 执行清理
   ✅ 备份创建: .issueManager/tree.json.backup.20260131_174500
   ✅ 移除节点 invalid001
   ✅ 移除节点 invalid002
   ✅ 移除节点 invalid003
   
   ### 结果
   - 移除节点: 3 个
   - 剩余有效节点: 153 个
   - 无效引用: 0 个
   
   ✅ 清理完成
   ```

## 使用技巧

### 1. 渐进式整理
不要一次性整理所有内容，可以分批进行：
- 第一次：清理明显的无效引用
- 第二次：处理过度的重复引用
- 第三次：优化层级结构
- 第四次：整理孤立节点

### 2. 充分利用备份
Agent 会自动创建备份，如果整理结果不满意：
```bash
# 恢复到备份
cp .issueManager/tree.json.backup.20260131_173000 .issueManager/tree.json
```

### 3. 定期维护
建议每周或每月运行一次完整分析：
```
请对我的问题树进行全面分析，
给出维护建议但暂时不要执行任何操作
```

### 4. 结合手动操作
对于复杂的重组，可以：
1. 使用 Agent 生成方案
2. 手动调整方案细节
3. 让 Agent 执行调整后的方案

## 注意事项

1. **大型树处理**：如果节点超过 500 个，建议分批处理
2. **保持专注**：一次只解决一类问题
3. **验证结果**：整理后在视图中验证结果
4. **备份重要**：确保 Agent 已创建备份
5. **渐进式改进**：多次小规模整理优于一次大规模重组

## 相关文档

- [Agent 配置文件](./.github/agents/issue-organizer.agent.md)
- [Agent 使用文档](./AGENT_ISSUE_ORGANIZER.md)
- [问题管理插件需求文档](./问题管理插件需求文档.md)
