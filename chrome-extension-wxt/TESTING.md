# Chrome 扩展测试指南

本文档提供了测试新 WXT + Vue Chrome 扩展的详细步骤。

## 🔧 前置条件

1. ✅ Node.js >= 18 已安装
2. ✅ Chrome 浏览器已安装
3. ✅ VSCode 已安装并运行
4. ✅ VSCode Issue Manager 扩展已启用
5. ✅ VSCode 中已配置问题目录

## 📦 构建扩展

在项目根目录运行：

```bash
# 开发模式（推荐用于测试）
npm run chrome:dev

# 或生产构建
npm run chrome:build
```

构建产物位于 `.output/chrome-mv3/` 目录。

## 🚀 安装扩展

1. 打开 Chrome 浏览器
2. 访问 `chrome://extensions/`
3. 开启右上角的"开发者模式"开关
4. 点击"加载已解压的扩展程序"
5. 选择项目根目录下的 `.output/chrome-mv3` 目录
6. 扩展应该出现在列表中，图标为紫色问号图标

## ✅ 功能测试清单

### 1. 基础安装测试

- [ ] 扩展图标显示在 Chrome 工具栏
- [ ] 图标显示正确（紫色问号）
- [ ] 点击图标，Side Panel 正常打开
- [ ] Side Panel 没有显示 JavaScript 错误（按 F12 检查控制台）

### 2. WebSocket 连接测试

- [ ] 确保 VSCode 正在运行
- [ ] 确保 VSCode Issue Manager 扩展已启用
- [ ] 打开 Side Panel
- [ ] 检查右下角连接状态：
  - 连接中：黄色圆点，显示"连接中..."
  - 已连接：绿色圆点，显示"已连接"
  - 未连接：红色圆点，显示"未连接"

**预期结果**: 如果 VSCode 正在运行且扩展已启用，应该显示"已连接"（绿色）。

### 3. 关注问题列表测试

前置条件：在 VSCode 中至少添加一个关注问题

- [ ] 打开 Side Panel
- [ ] 关注问题列表正确显示
- [ ] 每个问题显示：
  - 标题
  - 文件名
  - 修改时间
- [ ] 点击问题，VSCode 中打开对应文件

**如果列表为空**:
1. 在 VSCode 中打开 Issue Manager
2. 在"问题总览"或其他视图中右键点击一个问题
3. 选择"添加关注"
4. 回到 Chrome，点击 Side Panel 中的刷新按钮（🔄）

### 4. 内容选取测试

#### 4.1 进入选取模式

- [ ] 打开任意网页（如 https://example.com）
- [ ] 打开 Side Panel
- [ ] 点击"新建笔记"按钮（✨图标）
- [ ] 页面应该：
  - 出现半透明遮罩层
  - 显示提示："请点击页面任意区域以选中内容"

**如果选取模式未激活**:
- 刷新页面后重试
- 检查浏览器控制台是否有错误
- 某些特殊页面（如 `chrome://` 开头的页面）无法使用

#### 4.2 鼠标选取

- [ ] 将鼠标移动到页面不同元素上
- [ ] 元素应该高亮显示（蓝色边框）
- [ ] 高亮跟随鼠标移动
- [ ] 点击某个元素
- [ ] 显示提示："已选中！方向键可微调，回车或点击"确认"完成。"
- [ ] 右上角出现"确认"和"重新选择"按钮

#### 4.3 键盘导航

选中元素后：

- [ ] 按 `↑` 或 `→`：选择父元素（扩大范围）
- [ ] 按 `↓` 或 `←`：选择子元素（缩小范围）
- [ ] 显示对应提示信息
- [ ] 按 `Enter`：确认选取
- [ ] 按 `ESC`：取消选取模式

#### 4.4 确认和创建笔记

- [ ] 选中内容后，点击"确认"按钮或按 `Enter`
- [ ] 显示提示："✓ 内容已选取，正在创建笔记..."
- [ ] 选取模式自动退出（1秒后）
- [ ] Side Panel 显示："✅ 笔记创建成功！"

#### 4.5 在 VSCode 中验证

- [ ] 切换到 VSCode
- [ ] 新笔记文件应该自动打开
- [ ] 笔记内容包含：
  - 网页标题作为标题
  - 网页 URL
  - 选取的内容（转换为 Markdown）
- [ ] 新笔记应该出现在"孤立问题"视图中

### 5. 错误处理测试

#### 5.1 VSCode 未运行

- [ ] 关闭 VSCode
- [ ] 在 Chrome 中选取内容并确认
- [ ] 应显示错误消息，提示 WebSocket 连接失败
- [ ] 错误消息包含解决建议

#### 5.2 特殊页面

- [ ] 尝试在 `chrome://extensions/` 页面选取内容
- [ ] 应显示错误："该页面不支持内容脚本..."

#### 5.3 网络问题

- [ ] 暂停 VSCode 的 WebSocket 服务（在 VSCode 设置中禁用）
- [ ] 尝试选取内容
- [ ] 应尝试使用备用 URI 方式
- [ ] 或显示明确的错误消息

## 🐛 调试方法

### 查看 Background Script 日志

1. 访问 `chrome://extensions/`
2. 找到 "Issue Manager" 扩展
3. 点击"详细信息"
4. 点击"检查视图：service worker"
5. 查看 Console 标签页

### 查看 Side Panel 日志

1. 打开 Side Panel
2. 右键点击 Side Panel 内容区域
3. 选择"检查"
4. 查看 Console 标签页

### 查看 Content Script 日志

1. 在网页上按 `F12` 打开开发者工具
2. 查看 Console 标签页
3. 搜索 "Content Script" 或 "Issue Manager" 相关消息

## 📊 性能测试

### 构建大小

- [ ] 检查构建输出大小：
  ```bash
  npm run chrome:build
  # 查看输出的 "Total size"
  ```
- [ ] 预期总大小：约 88-90 kB
- [ ] 主要文件：
  - background.js: ~8 kB
  - sidepanel chunks: ~64 kB
  - content.js: ~10 kB

### 加载时间

- [ ] 打开 Side Panel
- [ ] 关注问题列表应在 1 秒内加载
- [ ] WebSocket 连接应在 3 秒内建立

### 内存占用

1. 打开 Chrome 任务管理器（Shift+Esc）
2. 找到 "扩展：Issue Manager"
3. 检查内存占用

预期：
- Background: < 20 MB
- Side Panel: < 30 MB
- Content Script: < 5 MB per tab

## ✨ 用户体验测试

### UI 响应性

- [ ] Side Panel 界面流畅，无卡顿
- [ ] 按钮点击有明显反馈
- [ ] 加载状态正确显示
- [ ] 错误消息清晰易懂

### 交互流畅度

- [ ] 选取模式进入和退出流畅
- [ ] 高亮框跟随鼠标无延迟
- [ ] 键盘导航响应及时
- [ ] 提示消息显示合理

## 🎯 测试场景

### 场景 1：快速笔记

1. 浏览网页时发现有用内容
2. 点击扩展图标打开 Side Panel
3. 点击"新建笔记"
4. 鼠标选取内容
5. 按 Enter 确认
6. 在 VSCode 中编辑和完善笔记

### 场景 2：精确选取

1. 进入选取模式
2. 粗略选中一个大区域
3. 使用方向键微调：
   - 按 `↓` 深入子元素
   - 按 `↑` 回到父元素
4. 找到精确的目标元素
5. 确认选取

### 场景 3：查看关注问题

1. 打开 Side Panel
2. 浏览关注问题列表
3. 点击某个问题在 VSCode 中打开
4. 在 VSCode 中修改问题
5. 回到 Chrome，刷新列表
6. 验证更改已同步

## 📝 测试报告模板

完成测试后，请记录：

```markdown
## 测试环境
- OS: 
- Chrome 版本: 
- VSCode 版本: 
- Issue Manager 扩展版本: 

## 测试结果
- [ ] 所有测试通过
- [ ] 部分测试失败（请详细说明）

## 发现的问题
1. 
2. 
3. 

## 改进建议
1. 
2. 
3. 
```

## 🎉 测试完成

如果所有测试通过，恭喜！扩展已准备好使用。

如果发现问题，请：
1. 查看本文档的"调试方法"部分
2. 查看 [README.md](README.md) 的"故障排除"部分
3. 查看 [MIGRATION_GUIDE.md](../MIGRATION_GUIDE.md)
4. 提交 [Issue](https://github.com/wedaren/vscode-issue-manager/issues)
