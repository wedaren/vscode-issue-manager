# 全文搜索功能说明

## 概述

全文搜索功能是问题管理器的重要增强，允许用户在所有问题的完整 Markdown 内容中搜索关键词，而不仅仅是标题和摘要。

## 功能特点

### 1. 真正的内容搜索
- **完整内容扫描**：搜索问题文件的整个内容，包括正文、代码块、列表等所有文本
- **智能匹配**：找到包含关键词的所有位置，提供丰富的上下文信息

### 2. 多种搜索模式
- **普通文本搜索**：默认模式，简单直接
- **正则表达式**：支持复杂的模式匹配
- **全词匹配**：精确匹配完整单词，避免部分匹配
- **大小写敏感**：可选择是否区分大小写

### 3. 匹配结果预览
- **上下文显示**：在搜索结果中直接显示匹配内容的上下文
- **行号标注**：清楚标识匹配内容所在的行号
- **智能截断**：自动截断过长的内容，保持界面整洁
- **Tooltip 预览**：鼠标悬停查看完整的匹配片段

### 4. 一键跳转
- **精确定位**：点击搜索结果自动打开文件并跳转到匹配行
- **自动居中**：将匹配行滚动到编辑器中心位置
- **选择高亮**：自动选中匹配行，便于快速识别

## 使用方法

### 启动搜索

1. 打开"问题搜索"视图
2. 点击视图标题栏的 "新增搜索" 按钮（`+` 图标）
3. 在弹出的搜索框中输入关键词
4. 从下拉列表中选择 `[关键词]--全文搜索` 选项
5. 按 Enter 确认，开始搜索

### 查看结果

搜索完成后，结果将以树状结构显示：
- **一级节点**：搜索记录（包含搜索关键词、时间和结果数量）
- **二级节点**：匹配的问题文件
  - 标题显示问题标题
  - 描述显示第一个匹配位置（行号 + 内容预览）
  - 图标显示为 `search` 图标

### 打开匹配项

点击任意搜索结果即可：
1. 自动打开对应的问题文件
2. 跳转到第一个匹配的行
3. 将该行滚动到编辑器中心
4. 选中该行，便于识别

## 配置选项

可以在 VS Code 设置中自定义全文搜索的行为：

### issueManager.search.fulltext.caseSensitive
- **类型**：布尔值
- **默认值**：`false`
- **说明**：是否区分大小写

### issueManager.search.fulltext.useRegex
- **类型**：布尔值
- **默认值**：`false`
- **说明**：是否启用正则表达式模式

### issueManager.search.fulltext.wholeWord
- **类型**：布尔值
- **默认值**：`false`
- **说明**：是否进行全词匹配

### issueManager.search.fulltext.maxResults
- **类型**：数字
- **默认值**：`100`
- **范围**：1-500
- **说明**：最大返回结果数量

### issueManager.search.fulltext.maxSnippetsPerFile
- **类型**：数字
- **默认值**：`3`
- **范围**：1-10
- **说明**：每个文件最多显示的匹配片段数量

### issueManager.search.fulltext.contextLines
- **类型**：数字
- **默认值**：`0`
- **范围**：0-5
- **说明**：匹配片段显示的上下文行数（0表示只显示匹配行）

## 配置示例

在 `settings.json` 中添加：

```json
{
  "issueManager.search.fulltext.caseSensitive": false,
  "issueManager.search.fulltext.useRegex": false,
  "issueManager.search.fulltext.wholeWord": false,
  "issueManager.search.fulltext.maxResults": 100,
  "issueManager.search.fulltext.maxSnippetsPerFile": 3,
  "issueManager.search.fulltext.contextLines": 1
}
```

## 搜索模式对比

| 搜索模式 | 搜索范围 | 速度 | 适用场景 |
|---------|---------|------|---------|
| **AI 搜索** | 标题、摘要 | 慢（需要 LLM） | 语义理解、模糊匹配 |
| **过滤搜索** | 标题、摘要、文件路径 | 快 | 快速筛选已知问题 |
| **全文搜索** | 完整内容 | 中等 | 深度内容检索 |

## 使用技巧

### 1. 组合使用搜索模式
- 先用"过滤搜索"快速查找标题相关的问题
- 再用"全文搜索"深入查找内容中的细节
- 最后用"AI 搜索"进行语义匹配

### 2. 利用正则表达式
启用正则表达式模式进行高级搜索：
- 搜索日期：`\d{4}-\d{2}-\d{2}`
- 搜索代码：`function\s+\w+`
- 搜索链接：`https?://.*`

### 3. 优化搜索结果
- 使用"全词匹配"减少误匹配
- 增加"上下文行数"获取更多信息
- 调整"最大结果数"控制搜索范围

### 4. 管理搜索历史
- 搜索记录自动保存在`.issueManager/issueSearchHistory.json`
- 展开记录节点查看历史搜索结果
- 点击历史结果快速访问之前找到的问题

## 性能说明

全文搜索会读取所有问题文件的内容，因此：
- 搜索速度取决于问题数量和文件大小
- 建议合理设置 `maxResults` 限制结果数量
- 大型知识库（>1000个文件）可能需要几秒钟完成搜索

## 限制和注意事项

1. **文件类型**：只搜索 `.md` (Markdown) 文件
2. **路径限制**：只搜索配置的问题目录内的文件
3. **编码支持**：支持 UTF-8 编码的文本文件
4. **内存使用**：大文件会占用更多内存，建议保持单个文件小于 1MB

## 故障排除

### 搜索无结果
- 检查关键词拼写是否正确
- 尝试关闭"大小写敏感"选项
- 尝试关闭"全词匹配"选项
- 确认问题文件确实包含该关键词

### 搜索速度慢
- 减少 `maxResults` 的值
- 减少 `maxSnippetsPerFile` 的值
- 考虑先用"过滤搜索"缩小范围

### 找不到期望的匹配
- 检查是否启用了不必要的限制选项
- 尝试使用更通用的关键词
- 考虑使用正则表达式进行模式匹配

## 未来改进计划

- [ ] 支持高级搜索语法（AND、OR、NOT）
- [ ] 支持搜索排除规则（忽略特定文件或路径）
- [ ] 支持搜索结果的二次过滤
- [ ] 支持搜索结果导出
- [ ] 支持搜索模板和预设
- [ ] 优化大规模搜索的性能

## 技术实现

全文搜索功能的核心实现：

1. **FullTextSearchService**：核心搜索引擎
   - 读取文件内容
   - 应用搜索模式（正则表达式）
   - 提取匹配片段和上下文
   - 限制结果数量

2. **IssueSearchViewProvider**：视图控制器
   - 管理搜索界面
   - 触发搜索操作
   - 展示搜索结果
   - 处理用户交互

3. **配置管理**：
   - 从 VS Code 配置读取选项
   - 提供合理的默认值
   - 支持运行时配置更新
