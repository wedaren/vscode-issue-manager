# è‡ªåŠ¨å‘å¸ƒ VS Code æ‰©å±•åˆ° Marketplace çš„ GitHub Actions å·¥ä½œæµ
# è¯·ç¡®ä¿åœ¨ä»“åº“ Secrets ä¸­è®¾ç½® VSCE_TOKENï¼ˆå³ vsce ç™»å½•ç”Ÿæˆçš„ Personal Access Tokenï¼‰

name: Publish VS Code Extension

run-name: 'ğŸš€ Release version ${{ github.ref_name }}'

on:
  push:
    tags:
      - 'v*.*.*'  # ä»…åœ¨æ¨é€ç¬¦åˆè¯­ä¹‰åŒ–ç‰ˆæœ¬å·çš„ tag æ—¶è§¦å‘

jobs:
  publish:
    runs-on: ubuntu-latest
    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      - name: è®¾ç½® Node.js ç¯å¢ƒ
        uses: actions/setup-node@v4
        with:
          node-version: '20.x'

      - name: å®‰è£…ä¾èµ–
        run: npm ci

      - name: å®‰è£… vsce å·¥å…·
        run: npm install -g vsce

      - name: æ‰“åŒ…å¹¶å‘å¸ƒæ‰©å±•
        env:
          VSCE_TOKEN: ${{ secrets.VSCE_TOKEN }}
        run: |
          vsce publish --no-git-tag-version --pat $VSCE_TOKEN
