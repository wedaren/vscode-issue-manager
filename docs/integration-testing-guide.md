# Chrome 扩展集成测试指南

本文档提供 Chrome 扩展与 VSCode 集成功能的测试步骤和验证清单。

## 测试环境准备

### 1. VSCode 端准备

- [ ] 确保已安装最新版本的 Issue Manager 扩展
- [ ] 配置问题目录（`issueManager.issueDir`）
- [ ] 确保问题目录存在且可写
- [ ] 启动 VSCode 并打开工作区

### 2. Chrome 端准备

- [ ] 安装 Chrome 扩展（开发者模式）
- [ ] 验证扩展图标显示在工具栏
- [ ] 能够打开 Side Panel

## 单元测试

### HTML 到 Markdown 转换测试

运行测试用例：

```bash
node test-html-to-markdown.js
```

验证以下元素的转换：

- [ ] 标题（H1-H6）
- [ ] 段落（P）
- [ ] 粗体和斜体（Strong, Em）
- [ ] 链接（A）
- [ ] 图片（Img）
- [ ] 列表（UL, OL）
- [ ] 代码块（Pre, Code）
- [ ] 引用（Blockquote）
- [ ] 表格（Table）

### 手动转换测试

在 VSCode 中使用命令面板测试：

1. 按 `Ctrl/Cmd + Shift + P` 打开命令面板
2. 输入 "Issue Manager: 从 HTML 创建问题"
3. 输入测试 HTML：
```html
<article>
  <h1>测试标题</h1>
  <p>这是一个 <strong>测试</strong> 段落。</p>
</article>
```
4. 验证创建的笔记内容正确

预期结果：
```markdown
# 测试标题

这是一个 **测试** 段落。
```

## 集成测试

### 测试场景 1：基本文章选取

**目标**：验证基本的内容选取和转换流程

**步骤**：

1. 打开测试网页（可以使用任何包含文章内容的网页）
2. 点击 Chrome 扩展图标，打开 Side Panel
3. 点击"新建笔记"按钮
4. 页面应进入选取模式（半透明背景）
5. 将鼠标移动到文章主体上
6. 文章主体应被蓝色边框高亮
7. 点击选中
8. 应显示"✓ 内容已选取，正在创建笔记..."
9. VSCode 应自动创建新文件并打开
10. 文件内容应包含转换后的 Markdown

**验证点**：

- [ ] Side Panel 正常打开
- [ ] 进入选取模式后页面状态正确
- [ ] 高亮显示准确
- [ ] 内容发送成功
- [ ] VSCode 接收到内容
- [ ] Markdown 转换正确
- [ ] 文件创建成功
- [ ] 文件自动打开

### 测试场景 2：取消选取

**目标**：验证取消选取功能

**步骤**：

1. 打开 Side Panel
2. 点击"新建笔记"
3. 进入选取模式
4. 按 `ESC` 键
5. 应退出选取模式，页面恢复正常

**验证点**：

- [ ] ESC 键正常工作
- [ ] 退出选取模式
- [ ] 高亮框消失
- [ ] 遮罩层移除
- [ ] 提示消息消失

### 测试场景 3：复杂内容转换

**目标**：验证复杂 HTML 结构的转换

**测试内容**：包含以下元素的网页

- 多级标题
- 嵌套列表
- 代码块
- 表格
- 链接和图片

**步骤**：

1. 访问包含复杂结构的网页（如技术文档）
2. 选取包含多种元素的内容
3. 验证转换结果

**验证点**：

- [ ] 标题层级正确
- [ ] 列表嵌套正确
- [ ] 代码块保留格式
- [ ] 表格结构正确
- [ ] 链接可点击
- [ ] 图片路径正确

### 测试场景 4：错误处理

**目标**：验证错误处理机制

#### 4.1 VSCode 未运行

**步骤**：

1. 关闭 VSCode
2. 在 Chrome 中选取内容
3. 应显示错误提示

**验证点**：

- [ ] 显示友好的错误消息
- [ ] 不会崩溃或卡死
- [ ] 能够重试

#### 4.2 选取空内容

**步骤**：

1. 选取一个空的 div 元素
2. 验证处理结果

**验证点**：

- [ ] 不会创建空文件
- [ ] 显示适当的提示

#### 4.3 选取脚本标签

**步骤**：

1. 故意选取 `<script>` 标签
2. 验证处理结果

**验证点**：

- [ ] 脚本内容被过滤
- [ ] 不会执行恶意代码
- [ ] 文件内容安全

### 测试场景 5：特殊页面

**目标**：测试在不同类型网页上的表现

**测试页面类型**：

1. [ ] 静态 HTML 页面
2. [ ] SPA（单页应用）
3. [ ] 动态加载内容的页面
4. [ ] 使用 Shadow DOM 的页面
5. [ ] iframe 嵌套的页面

**验证点**：

- 能够正常选取内容
- 或者给出合理的提示说明无法选取

## 性能测试

### 大内容测试

**步骤**：

1. 选取一个超长的文章（>10000 字）
2. 观察转换时间
3. 验证内存使用

**验证点**：

- [ ] 转换时间 < 3 秒
- [ ] 不会卡死浏览器
- [ ] 不会卡死 VSCode
- [ ] 内存使用合理

### 连续使用测试

**步骤**：

1. 连续创建 10 个笔记
2. 观察性能表现

**验证点**：

- [ ] 每次操作都能成功
- [ ] 性能不会降低
- [ ] 不会出现内存泄漏

## 兼容性测试

### 浏览器版本

- [ ] Chrome 最新稳定版
- [ ] Chrome Beta 版
- [ ] Chromium

### VSCode 版本

- [ ] VSCode 1.101.0（最低版本）
- [ ] VSCode 最新稳定版

### 操作系统

- [ ] Windows 10/11
- [ ] macOS
- [ ] Linux（Ubuntu）

## 用户体验测试

### UI/UX 验证

- [ ] Side Panel 界面美观
- [ ] 按钮响应迅速
- [ ] 状态指示清晰
- [ ] 错误消息友好
- [ ] 操作流程直观

### 无障碍访问

- [ ] 键盘导航可用
- [ ] 屏幕阅读器支持（如果适用）
- [ ] 高对比度模式支持

## 测试结果模板

### 测试执行记录

| 测试场景 | 执行时间 | 结果 | 问题描述 | 严重程度 |
|---------|---------|------|---------|---------|
| 基本文章选取 | 2025-10-15 | ✅ Pass | - | - |
| 取消选取 | 2025-10-15 | ✅ Pass | - | - |
| 复杂内容转换 | 2025-10-15 | ⚠️ Warning | 表格边框不对齐 | Low |
| VSCode 未运行 | 2025-10-15 | ❌ Fail | 错误消息不够明确 | Medium |

### 问题严重程度定义

- **Critical（严重）**：功能完全不可用，阻塞发布
- **High（高）**：核心功能受影响，需要修复
- **Medium（中）**：非核心功能受影响，建议修复
- **Low（低）**：微小问题，可以延后修复

## 回归测试清单

在每次代码更新后，执行以下快速验证：

- [ ] 基本文章选取流程
- [ ] 取消选取功能
- [ ] HTML 转 Markdown 基本元素
- [ ] 错误处理（VSCode 未运行）
- [ ] Side Panel 打开和关闭

## 自动化测试（未来）

### 计划实现的自动化测试

1. **单元测试**
   - HTML 转 Markdown 转换器
   - 内容处理器
   - 工具函数

2. **E2E 测试**
   - 使用 Puppeteer 模拟用户操作
   - 自动验证转换结果
   - 自动化性能测试

3. **CI/CD 集成**
   - GitHub Actions 自动运行测试
   - 自动生成测试报告
   - 失败时自动通知

## 测试数据

### 示例网页

可以使用以下网页进行测试：

1. **MDN Web Docs**：https://developer.mozilla.org/
   - 包含代码块、表格、列表
2. **Wikipedia**：https://wikipedia.org/
   - 复杂的内容结构
3. **GitHub README**：任何项目的 README
   - Markdown 友好的内容
4. **博客文章**：Medium, Dev.to 等平台
   - 真实的使用场景

### 测试 HTML 模板

在 `test-html-to-markdown.js` 中包含了多个测试用例，可以直接使用。

## 总结

完成上述所有测试后，应该能够确保：

✅ 核心功能正常工作  
✅ 错误处理完善  
✅ 用户体验良好  
✅ 性能满足要求  
✅ 兼容性广泛  

如发现任何问题，请记录在 GitHub Issues 中。
