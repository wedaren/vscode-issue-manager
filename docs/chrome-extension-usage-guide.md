# Chrome 扩展使用指南

本文档详细介绍如何使用 Issue Manager Chrome 扩展从网页选取内容并在 VSCode 中创建笔记。

## 目录

1. [安装与配置](#安装与配置)
2. [基本使用](#基本使用)
3. [高级功能](#高级功能)
4. [常见问题](#常见问题)
5. [开发与调试](#开发与调试)

## 安装与配置

### 前置条件

在使用 Chrome 扩展之前，请确保：

- ✅ 已安装 VSCode（版本 >= 1.101.0）
- ✅ 已安装 Issue Manager VSCode 扩展
- ✅ 已配置问题目录（`issueManager.issueDir`）
- ✅ VSCode 正在运行

### 安装 Chrome 扩展

#### 方式一：开发者模式（推荐用于测试）

1. 打开 Chrome 浏览器
2. 在地址栏输入 `chrome://extensions/` 并回车
3. 在页面右上角开启"开发者模式"
4. 点击"加载已解压的扩展程序"
5. 选择项目中的 `chrome-extension` 目录
6. 扩展安装成功后，会在工具栏显示图标

#### 方式二：Chrome Web Store（待发布）

发布后可以直接从 Chrome Web Store 安装。

### 验证安装

1. 点击 Chrome 工具栏中的扩展图标
2. 应该能看到 Side Panel 打开
3. 如果看到"📝 笔记选取器"界面，说明安装成功

## 基本使用

### 快速开始

以下是完整的使用流程示例：

#### 1. 打开 Side Panel

- **方法一**：点击 Chrome 工具栏中的扩展图标
- **方法二**：右键点击扩展图标 → "打开侧边栏"

#### 2. 浏览目标网页

导航到包含您想保存内容的网页。例如：

- 技术博客文章
- 文档页面
- 新闻报道
- 产品介绍

#### 3. 开始选取

1. 在 Side Panel 中点击"新建笔记"按钮
2. 网页会进入选取模式：
   - 页面背景变为半透明
   - 出现提示消息："请选择要保存的内容，按 ESC 取消"

#### 4. 选择内容

1. 将鼠标移动到要保存的内容上
2. 目标元素会被蓝色边框高亮显示
3. 点击选中该元素

💡 **提示**：选择包含完整内容的元素，如 `<article>`、`<div class="content">` 等

#### 5. 确认创建

1. 选中后，会显示"✓ 内容已选取，正在创建笔记..."
2. 内容自动发送到 VSCode
3. VSCode 会：
   - 将 HTML 转换为 Markdown
   - 自动生成标题（或使用页面标题）
   - 创建新的笔记文件
   - 自动打开该文件

### 示例：保存技术文章

**场景**：在阅读一篇关于 TypeScript 的博客文章

1. 打开文章页面
2. 点击扩展图标打开 Side Panel
3. 点击"新建笔记"
4. 鼠标移动到文章主体部分（通常是 `<article>` 或 `.post-content`）
5. 当整篇文章被高亮时，点击选中
6. VSCode 自动创建笔记，包含：
   - 文章标题（H1）
   - 格式化的正文内容
   - 保留的代码块
   - 保留的链接和图片
   - 页面来源 URL

## 高级功能

### 选取策略

#### 选取整篇文章

适合保存完整的博客文章或文档：

1. 将鼠标移动到文章容器元素上
2. 确保高亮区域覆盖了所有内容
3. 点击选中

#### 选取特定部分

只保存文章中的某个章节：

1. 将鼠标移动到目标章节的标题上
2. 如果高亮区域包含了该章节的全部内容，点击选中
3. 如果需要更大的范围，将鼠标移动到父元素上

#### 选取列表或表格

保存特定的列表或表格：

1. 将鼠标移动到 `<ul>`、`<ol>` 或 `<table>` 元素上
2. 确认高亮区域正确
3. 点击选中

### 内容转换详解

#### 支持的 HTML 元素

| HTML 元素 | 转换结果 | 说明 |
|-----------|----------|------|
| `<h1>` - `<h6>` | `#` - `######` | 标题层级 |
| `<p>` | 段落 | 空行分隔 |
| `<strong>`, `<b>` | `**粗体**` | 强调文本 |
| `<em>`, `<i>` | `*斜体*` | 斜体文本 |
| `<code>` | `` `代码` `` | 内联代码 |
| `<pre><code>` | `` ```代码块``` `` | 代码块 |
| `<a>` | `[文本](链接)` | 超链接 |
| `<img>` | `![alt](src)` | 图片 |
| `<ul>`, `<ol>` | 列表 | 无序/有序列表 |
| `<blockquote>` | `> 引用` | 引用块 |
| `<table>` | Markdown 表格 | 表格 |
| `<br>` | 换行 | 双空格+换行 |
| `<hr>` | `---` | 分隔线 |

#### 自动处理的内容

- ✅ 移除 `<script>` 和 `<style>` 标签
- ✅ 清理多余的空行
- ✅ 保留文本语义格式
- ✅ 转换嵌套结构
- ✅ 处理 HTML 实体编码

#### 不转换的内容

- ❌ CSS 样式（颜色、字体等）
- ❌ JavaScript 交互
- ❌ SVG 图形（会被忽略）
- ❌ 视频和音频（仅保留链接）

### 元信息

创建的笔记会自动包含以下元信息：

```markdown
---
**来源**: [https://example.com/article](https://example.com/article)  
**创建时间**: 2025-10-15 11:30:00

```

### 键盘快捷键

在选取模式中：

- `ESC` - 取消选取，退出选取模式

## 常见问题

### 无法连接到 VSCode

**症状**：点击选取内容后，显示"无法连接到 VSCode"错误

**解决方案**：

1. 确保 VSCode 正在运行
2. 确保 Issue Manager 扩展已启用：
   - 在 VSCode 中按 `Ctrl/Cmd + Shift + X` 打开扩展面板
   - 搜索"Issue Manager"
   - 确认已启用
3. 检查是否已配置问题目录：
   - 打开 VSCode 设置 (`Ctrl/Cmd + ,`)
   - 搜索 `issueManager.issueDir`
   - 确保已设置有效的目录路径

### 选取的内容格式不正确

**症状**：创建的笔记内容格式混乱或缺失

**可能原因**：

1. 选中了错误的元素（如选中了导航栏或侧边栏）
2. 网页使用了复杂的 JavaScript 渲染

**解决方案**：

1. 重新选取，确保高亮区域只包含目标内容
2. 尝试选取更具体的元素（而不是整个页面）
3. 对于动态内容，等待页面完全加载后再选取

### 页面无法进入选取模式

**症状**：点击"新建笔记"后，页面没有变化

**可能原因**：

1. Content Script 未正确注入
2. 页面使用了 CSP（内容安全策略）限制

**解决方案**：

1. 刷新页面后重试
2. 检查浏览器控制台是否有错误信息
3. 某些特殊页面（如 Chrome 设置页、新标签页）无法使用 Content Script

### 图片无法显示

**症状**：笔记中的图片无法加载

**原因**：图片使用相对路径或需要认证

**解决方案**：

1. 图片 URL 会被保留在 Markdown 中
2. 如果图片无法访问，可以：
   - 手动下载图片并更新链接
   - 使用网页快照工具
   - 删除图片引用

### 选取模式卡住

**症状**：进入选取模式后无法退出

**解决方案**：

1. 按 `ESC` 键退出选取模式
2. 如果无效，在 Side Panel 中点击"取消选取"
3. 如果仍无效，刷新页面

## 开发与调试

### 查看日志

#### Background Script 日志

1. 打开 `chrome://extensions/`
2. 找到"Issue Manager"扩展
3. 点击"详细信息"
4. 点击"检查视图：background page"
5. 在打开的开发者工具中查看 Console 日志

#### Content Script 日志

1. 在目标网页中按 `F12` 打开开发者工具
2. 切换到 Console 标签
3. 查找以 "Content Script" 开头的日志

#### Side Panel 日志

1. 打开 Side Panel
2. 右键点击 Side Panel 内容区域
3. 选择"检查"
4. 在打开的开发者工具中查看 Console 日志

### 修改和重新加载

如果您修改了扩展代码：

1. 打开 `chrome://extensions/`
2. 找到"Issue Manager"扩展
3. 点击"重新加载"按钮（刷新图标）
4. 刷新正在使用扩展的网页
5. 重新打开 Side Panel

### 调试通信流程

完整的通信流程日志：

1. **Side Panel**：`Start selection clicked`
2. **Background**：`Background received message: {type: 'START_SELECTION'}`
3. **Content Script**：`Content Script received message: {type: 'START_SELECTION'}`
4. **Content Script**：`Starting selection mode`
5. **Content Script**（点击后）：`Element selected: {...}`
6. **Background**：`Background received message: {type: 'CONTENT_SELECTED'}`
7. **Background**：`Content selected: {...}`
8. **VSCode**：接收并处理内容

### 常见开发问题

#### 修改后不生效

**解决方案**：确保执行了"重新加载"操作，并刷新了所有相关页面。

#### Content Script 无法注入

**解决方案**：检查 `manifest.json` 中的 `content_scripts` 配置，确保 `matches` 模式正确。

#### 权限不足

**解决方案**：检查 `manifest.json` 中的 `permissions` 和 `host_permissions` 配置。

## 最佳实践

### 选取内容的建议

1. ✅ **选取完整的语义块**：选择 `<article>`、`<section>` 等语义化元素
2. ✅ **避免选取导航和页脚**：只选取主要内容区域
3. ✅ **检查高亮范围**：确保高亮区域包含了所有需要的内容
4. ✅ **等待页面加载完成**：避免选取尚未完全渲染的内容

### 组织笔记

1. 使用有意义的标题
2. 在笔记中添加自己的注释和总结
3. 使用标签（通过 frontmatter）分类笔记
4. 定期整理和归档笔记

### 性能优化

1. 避免选取超大的元素（如整个页面）
2. 对于大型内容，考虑分段保存
3. 定期清理不再需要的笔记

## 支持与反馈

如果遇到问题或有改进建议，请：

1. 查看本文档的"常见问题"部分
2. 在 GitHub 仓库提交 Issue：https://github.com/wedaren/vscode-issue-manager/issues
3. 包含详细的错误信息和复现步骤

## 更新日志

### v1.0.0（当前版本）

- ✨ 初始版本发布
- 🎨 实现可视化 DOM 选取
- 🔄 实现与 VSCode 的双向通信
- 📝 支持常见 HTML 元素转换为 Markdown
- 🚀 Side Panel 用户界面

### 计划中的功能

- 🔜 支持选取多个元素
- 🔜 内容预览功能
- 🔜 自定义转换规则
- 🔜 批量保存功能
- 🔜 网页快照（保存完整页面）
