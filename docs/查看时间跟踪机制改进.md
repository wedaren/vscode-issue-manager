# 查看时间跟踪机制改进

## 问题
之前的实现需要在每个打开文件的命令中都添加查看时间跟踪代码，例如创建专门的 `issueManager.openAndViewRelatedIssuesWithTracking` 命令。这种方式有以下问题：

1. **代码重复**: 需要在多个地方添加跟踪代码
2. **维护困难**: 容易遗漏某些文件打开的场景
3. **不够优雅**: 需要创建额外的命令来处理跟踪

## 解决方案
使用 VS Code 的全局事件监听器 `vscode.window.onDidChangeActiveTextEditor` 来自动跟踪所有文件的打开行为。

### 实现方式

```typescript
// 在 extension.ts 中添加全局监听器
context.subscriptions.push(vscode.window.onDidChangeActiveTextEditor((editor) => {
    if (editor && editor.document) {
        const document = editor.document;
        const issueDir = getIssueDir();
        
        // 只对问题目录下的markdown文件记录查看时间
        if (issueDir && 
            document.uri.scheme === 'file' && 
            document.fileName.endsWith('.md') && 
            document.fileName.startsWith(issueDir)) {
            
            // 记录查看时间
            recentIssuesProvider.recordViewTime(document.fileName);
        }
    }
}));
```

### 优势

1. **全自动**: 无论通过什么方式打开问题目录下的 Markdown 文件，都会自动记录查看时间
2. **零侵入**: 不需要修改现有的任何命令或视图
3. **维护简单**: 只需要在一个地方管理跟踪逻辑
4. **覆盖全面**: 包括以下所有打开场景：
   - 通过各个视图点击打开
   - 通过命令面板打开
   - 通过文件资源管理器打开
   - 通过搜索结果打开
   - 通过其他扩展或快捷键打开

### 技术细节

- **监听事件**: `onDidChangeActiveTextEditor` - 当用户切换到不同的编辑器时触发
- **过滤条件**: 
  - `document.uri.scheme === 'file'` - 只处理本地文件
  - `document.fileName.endsWith('.md')` - 只处理 Markdown 文件  
  - `document.fileName.startsWith(issueDir)` - 只处理问题目录下的文件
- **方法访问**: 将 `recordViewTime` 方法改为 `public` 以供 extension.ts 调用

### 清理工作

删除了不再需要的代码：
- 移除 `issueManager.openAndViewRelatedIssuesWithTracking` 命令
- 恢复使用原来的 `issueManager.openAndViewRelatedIssues` 命令
- 简化了文件树项的创建逻辑

## 结果

现在用户打开问题目录下的任何 Markdown 文件时，都会自动记录查看时间，无需任何额外的操作或命令。这使得"按最近查看"排序功能变得完全透明和自动化。
